---
title: "DDDとの付き合い方"
emoji: "🦍"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: ['DDD']
published: false
---

## この記事の目的
DDDとの向き合い方を整理したい

## 想定読者
DDDを学んだがどこまで忠実にやるべきか迷っている人

## DDDの重要なこと


### 事業活動を分析する

事業活動の分析

良いモデルを作る
変更可能性がどこまであるか、どこまで柔軟性を許容するか

### 「同じ言葉」 を作る

コミュニケーションの齟齬はすぐ品質低下につながります

ソフトウェアエンジニアから、対象の領域がどう見えているかのフィードバックにもなります。

### 境界づけられた文脈を発見する



## 実装に関してはほとんど無視して良い

多くの方が指摘されているDDDの問題ですが、（特にEric Evanceの）DDDの実装パターンは、今現在ではあまり有用なものではありません。
Eric Evanceのドメイン駆動設計はPoEAA^[[エンタープライズアプリケーションアーキテクチャパターン](https://amzn.asia/d/5lJ4D2X)]の時代に書かれており、その影響を強く受けています。
また、[ファウラー自身が指摘しているように](https://martinfowler.com/eaaDev/)、イベントソーシングといった現代の設計において重要な概念が含まれていないといった問題もあります。

また、PoEAAはRuby on Railsが世を席巻する以前に書かれたもので、アクティブレコードをベースとしたフレームワークがここまで広く使われることは想定されていません。

「ドメイン駆動設計を始めよう」では一部アップデートされた実装方法の話が出ていますが、いまだに古く感じられる内容も多いです。
~~特にEqualsメソッドをオーバライドして比較演算子(==)でオブジェクトの等価性を検証できるようにするとかは絶対に辞めてほしいと思いました。~~

とは言え、DDDやPoEAAのパターンのうち現代でも役に立つものはありますし、共通の語彙として理解しておいて損はないとも思います。

### ただし指針を持っていないなら参考にしても良い

ドメイン駆動設計自体は設計が何もわからない状態で「ソフトウェア 設計」のような検索ワードでGoogle検索をした際に、クリーンアーキテクチャと同列のような形で出てきてしまうことも多いです。

これらの関係や区別がわからない時には、一度参考にしてみても、全く何もない状況よりは、Betterだと思います。

## （リレーショナル）データベース設計の話が一切出てこないことはモデリング・設計論としては不十分

ここが筆者としては一番課題に感じているところです。

現代のDDDが必要になるような開発においてリレーショナルデータベース（Rデータベース）は多くの場合必須です。

一時的にドキュメント指向のデータベースMSの流行もありましたが、一定規模を超えるとデータの整合性を担保することが難しいため、限られたユースケースのみで使われることが多いと思います。

[そーだいさん](https://x.com/soudai1025)が[失敗から学ぶ Rデータベースの正しい歩き方](https://gihyo.jp/book/2019/978-4-297-10408-5)を執筆された時におっしゃっている通りです。

> 「⁠データベースの寿命はアプリケーションよりも長い」が筆者の持論です。なぜならば，データベースはサービス開発当初から存在することが一般的で，アプリケーションコードのようにリプレースされることは稀だからです。また複数のサービスから参照されることも多々あり，その場合，最初に使われていたサービスが終了しても，データベースはほかのサービスとともに運用され続けます。

https://gihyo.jp/book/2019/978-4-297-10408-5/content/preface

### データベース設計とアプリケーション設計は概念（としてのドメイン）モデルの写像

データベース設計では概念モデルと呼ばれているものとDDDのドメインモデルはエンティティの抜き出し、関連付け、ふるまいを考えるところまで共通しています。

データベース設計に用いられるER図はこのエンティティとその関連を表現するための図法であり、クラス図などよりも関連を表現する上で優れています。
（筆者はクラス図は書かないことが多いです）

そのため、ER図を先に書いて、アプリケーションの設計をすることが自然だと感じています。

（同じこと言ってる）
アプリケーションレイヤーのことを考える際には細かいロジックとそのテストまで考える必要がありますが、エンティティの抜き出し、関連付け、ふるまいを考えるところまでは共通しているので、一連の流れとしてデータベースの論理設計まではアプリケーション設計の前段に行われることが自然ではないでしょうか。


